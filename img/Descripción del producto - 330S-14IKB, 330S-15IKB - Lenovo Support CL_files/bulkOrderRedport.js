function _instanceof(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return left instanceof right}}var bulkRedportOption={};(function(redportOption){function svsOption(serviceOption){serviceOption.addonSelection=[];serviceOption.warrantySelection=null;serviceOption.serviceMap={};serviceOption.rawdata={};serviceOption.init=function(initData){try{var temp;var found;initData.forEach(function(x){if(x.type==="warranty"&&x.own>0){temp=JSON.parse(JSON.stringify(x));temp.duration=[temp.own];temp.name="CURRENT"}if(x.type==="warranty"&&x.name==="CURRENT")found=true});if(!found&&temp)initData.push(temp);serviceOption.rawdata=JSON.parse(JSON.stringify(initData));initData.forEach(function(x){if(x.type==="addon"&&x.own>0){}serviceOption.serviceMap[x.name]=x});if(!serviceOption.serviceMap["CURRENT"])serviceOption.serviceMap["CURRENT"]={"name":"CURRENT","code":null,"type":null,"duration":[],"dependency":[],"pn":null,"own":-1};serviceOption.warrantySelection={"name":"CURRENT","duration":serviceOption.serviceMap["CURRENT"].own}}catch(error){}};serviceOption.click=function(name,duration){var found=false;serviceOption.rawdata.forEach(function(y){if(y.code==name&&y.duration.indexOf(duration)>=0){found=true}if(found){return}});if(!found)return null;try{var service=serviceOption.serviceMap[name];if(service){if(service.type==="warranty"){return serviceOption.warrantyClick(name,duration)}if(service.type==="addon"){var sss=serviceOption.addonClick(name,duration);return sss}}}catch(error){}return serviceOption.addonClick("none",12)};serviceOption.warrantyClick=function(name,duration){var show=[];var select=[];if(name==="CURRENT"||name===serviceOption.warrantySelection.name&&duration===serviceOption.warrantySelection.duration){name="CURRENT";duration=serviceOption.serviceMap["CURRENT"].own;if(duration!=-1)serviceOption.warrantySelection={"name":"CURRENT","duration":serviceOption.serviceMap["CURRENT"].own};else serviceOption.warrantySelection={"name":"CURRENT","duration":-1}}else{serviceOption.warrantySelection={"name":name,"duration":duration}}select=serviceOption.buildSelect(name,duration,true);show=serviceOption.buildShow(name,duration);serviceOption.filter(select,select);serviceOption.filter(show,select);serviceOption.setISEduration(select,show);serviceOption.dealPcPlus(select,show);return{"show":show,"select":select}};serviceOption.addonClick=function(name,duration){var show=[];var select=[];var temp=null;var needAdd=true;serviceOption.addonSelection.forEach(function(x){if(x.name===name){needAdd=false;if(x.duration===duration)temp=x;else x.duration=duration}});if(temp){serviceOption.addonSelection.splice(serviceOption.addonSelection.indexOf(temp),1)}else{if(needAdd){if(serviceOption.serviceMap[name]&&serviceOption.serviceMap[name].duration.indexOf(duration)>-1)serviceOption.addonSelection.push({"name":name,"duration":duration})}}select=serviceOption.buildSelect(serviceOption.warrantySelection.name,serviceOption.warrantySelection.duration,false);show=serviceOption.buildShow(serviceOption.warrantySelection.name,serviceOption.warrantySelection.duration);serviceOption.filter(select,select);serviceOption.filter(show,select);serviceOption.setISEduration(select,show);serviceOption.dealPcPlus(select,show);return{"show":show,"select":select}};serviceOption.addonChangeDuration=function(name,duration){var show=[];var select=[];var temp=null;serviceOption.addonSelection.forEach(function(x){if(x.name===name){x.duration=duration}});select=serviceOption.buildSelect(serviceOption.warrantySelection.name,serviceOption.warrantySelection.duration);show=serviceOption.buildShow(serviceOption.warrantySelection.name,serviceOption.warrantySelection.duration);serviceOption.filter(select,select);serviceOption.filter(show,select);return{"show":show,"select":select}};serviceOption.buildSelect=function(warrantyName,warrantyDuration,iswarrantyClicked){if(warrantyDuration<=0)return[];var result=[];var hidden=[];result.push({"name":warrantyName,"duration":warrantyDuration});serviceOption.addonSelection.forEach(function(x){var service=serviceOption.serviceMap[x.name];if(iswarrantyClicked&&service.duration.indexOf(warrantyDuration)>=0){result.push({"name":x.name,"duration":warrantyDuration});return}if(x.duration<=warrantyDuration){result.push(x);return}if(service.duration.indexOf(warrantyDuration)>=0){result.push({"name":x.name,"duration":warrantyDuration});return}hidden.push(x)});serviceOption.addonSelection.splice(0,serviceOption.addonSelection.length);result.forEach(function(x){if(serviceOption.serviceMap[x.name].type==="addon"){serviceOption.addonSelection.push(x)}});hidden.forEach(function(x){if(serviceOption.serviceMap[x.name].type==="addon"){serviceOption.addonSelection.push(x)}});return result};serviceOption.buildShow=function(warrantyName,warrantyDuration){if(warrantyDuration<=0)return[];var result=[];serviceOption.rawdata.forEach(function(x){var service=serviceOption.serviceMap[x.name];for(var i=warrantyDuration;i>=12;i=i-12){if(service.duration.indexOf(i)>=0){result.push({"name":x.name,"duration":i});break}}});return result};serviceOption.filter=function(data,select){var removelist=[];data.forEach(function(x){var service=serviceOption.serviceMap[x.name];if(service.dependency.length===0)return;var found=false;for(var i in service.dependency){for(var j in serviceOption.rawdata){if(serviceOption.rawdata[j].own>0&&service.dependency[i]===serviceOption.rawdata[j].code){found=true;break}}if(found)break;for(var j in select){if(service.dependency[i]===select[j].name){found=true;break}}if(found)break}if(found)return;removelist.push(x)});removelist.forEach(function(x){data.splice(data.indexOf(x),1)})};serviceOption.dealPcPlus=function(select,show){var removelist=[];var selectedPcPlus=false;select.forEach(function(x){if(x.name==="PREMIUMCAREPLUS")selectedPcPlus=true});if(selectedPcPlus){removelist=[];select.forEach(function(x){if(x.name==="ADP"||x.name==="SB"||x.name==="ADPONE")removelist.push(x)});removelist.forEach(function(x){select.splice(select.indexOf(x),1)});removelist=[];show.forEach(function(x){if(x.name==="ADP"||x.name==="SB"||x.name==="ADPONE")removelist.push(x)});removelist.forEach(function(x){show.splice(show.indexOf(x),1)})}};serviceOption.setISEduration=function(select,show){var duration=0;var iseown=0;serviceOption.rawdata.forEach(function(x){if(x.name==="ADP"||x.name==="KYD"||x.name==="SB"){if(x.own>duration)duration=x.own}if(x.name==="ISE"){if(x.own>iseown)iseown=x.own}});select.forEach(function(x){if(x.name==="ADP"||x.name==="KYD"||x.name==="SB"){if(x.duration>duration)duration=x.duration}});if(duration<=iseown){duration=0}var temp=null;show.forEach(function(x){if(x.name==="ISE"){if(duration>0)x.duration=duration;else temp=x}});if(temp){show.splice(show.indexOf(temp),1)}temp=null;select.forEach(function(x){if(x.name==="ISE"){if(duration>0)x.duration=duration;else temp=x}});if(temp){select.splice(select.indexOf(temp),1)}}}var res=[];valid={good:[0,0,0,0,0,0,0,0],better:[0,0,0,0,0,0,0,0],best:[0,0,0,0,0,0,0,0],adp:[0,0,0,0,0,0,0,0],kyd:[0,0,0,0,0,0,0,0],sb:[0,0,0,0,0,0,0,0],ticru:[0,0,0,0,0,0,0,0],ise:[0,0,0,0,0,0,0,0],fixedEnd:false};var level={PREMIER:"best",PREMIUMCARE:"best",LEGIONULTIMATE:"best",PREMIERDEPOT:"best",PREMIUMCAREDEPOT:"best",LEGIONULTIMATEDEPOT:"best",PREMIUMCAREPLUS:"best",PREMIUMCAREDEPOTPLUS:"best",ADPONE:"best",ONSITE:"better",PREMIUMCAREDEPOTANDROID:"better",DEPOT:"good",MAILIN:"good",CARRYIN:"good",ADP:"adp",SB:"sb",KYD:"kyd",TICRU:"ticru",ISE:"ise"};var data=null;var snContexts={};var valid2=null;var initData=null;var plusWarranty=["PREMIUMCAREPLUS","PREMIUMCAREDEPOTPLUS"];bulkRedportOption.init=function(initData){this.initData=JSON.parse(JSON.stringify(initData));this.initData.forEach(function(x){x.data.level={PREMIER:"NONE",PREMIUMCARE:"NONE",LEGIONULTIMATE:"NONE",PREMIERDEPOT:"NONE",PREMIUMCAREDEPOT:"NONE",LEGIONULTIMATEDEPOT:"NONE",PREMIUMCAREPLUS:"NONE",PREMIUMCAREDEPOTPLUS:"NONE",ADPONE:"NONE",ONSITE:"NONE",PREMIUMCAREDEPOTANDROID:"NONE",DEPOT:"NONE",MAILIN:"NONE",CARRYIN:"NONE",ADP:"adp",SB:"sb",KYD:"kyd",TICRU:"ticru",ISE:"ise"};x.data.recommendations.forEach(function(rec){x.data.level[rec.code]=rec.level.toLowerCase()})});res=JSON.parse(JSON.stringify(this.initData));valid={good:[0,0,0,0,0,0,0,0],better:[0,0,0,0,0,0,0,0],best:[0,0,0,0,0,0,0,0],adp:[0,0,0,0,0,0,0,0],kyd:[0,0,0,0,0,0,0,0],sb:[0,0,0,0,0,0,0,0],ticru:[0,0,0,0,0,0,0,0],ise:[0,0,0,0,0,0,0,0],fixedEnd:false};var price1={good:[0,0,0,0,0,0,0,0],better:[0,0,0,0,0,0,0,0],best:[0,0,0,0,0,0,0,0],adp:[0,0,0,0,0,0,0,0],kyd:[0,0,0,0,0,0,0,0],sb:[0,0,0,0,0,0,0,0],ticru:[0,0,0,0,0,0,0,0],ise:[0,0,0,0,0,0,0,0]};snContexts={};data=[];res.forEach(function(r){r.data.jsServices.forEach(function(x){if(!x.duration||x.duration.length===0){return}x.duration.forEach(function(y){try{if(r.data.level[x.name]&&y<=r.data.ibaseInfo.machineInfo.maxDuration&&y>x.own){var warrantyPrice=getWarrantyPrice(r,x.name,y);if(warrantyPrice>0){valid[r.data.level[x.name]][y/12-1]++;price1[r.data.level[x.name]][y/12-1]+=warrantyPrice;var reinstatement=r.data.others.find(function(z){return z.warrantyCode=="REINSTATEMENT"});if(r.data.chargeReinstatementFee&&reinstatement){price1[r.data.level[x.name]][y/12-1]+=reinstatement.price.includingTaxAndDiscountValue[0]||0}}}}catch(err){}})})});this.baseValid=JSON.parse(JSON.stringify(valid));this.basePrice=JSON.parse(JSON.stringify(price1));return valid};bulkRedportOption.run=function(originalSelects){var item=[];valid=JSON.parse(JSON.stringify(this.baseValid));valid.adp=[0,0,0,0,0,0,0,0];valid.kyd=[0,0,0,0,0,0,0,0];valid.sb=[0,0,0,0,0,0,0,0];valid.ticru=[0,0,0,0,0,0,0,0];valid.ise=[0,0,0,0,0,0,0,0];price=JSON.parse(JSON.stringify(this.basePrice));price.adp=[0,0,0,0,0,0,0,0];price.kyd=[0,0,0,0,0,0,0,0];price.sb=[0,0,0,0,0,0,0,0];price.ticru=[0,0,0,0,0,0,0,0];price.ise=[0,0,0,0,0,0,0,0];this.initData.forEach(function(sndata){var _sndata_data_jsServices_find;var selects=JSON.parse(JSON.stringify(originalSelects));window.redportOption.init(sndata.data.jsServices);var rr=null;var bad=false;var remarks=[];var start=sndata.data.ibaseInfo.baseWarranties[0].startDate;var end=sndata.data.ibaseInfo.currentWarranty.endDate;var maxDuration=sndata.data.ibaseInfo.machineInfo.maxDuration;var currentDeliveryType=sndata.data.ibaseInfo.currentWarranty.deliveryTypeList[0]||"";var currentDuration=((_sndata_data_jsServices_find=sndata.data.jsServices.find(function(x){return x.code==currentDeliveryType}))===null||_sndata_data_jsServices_find===void 0?void 0:_sndata_data_jsServices_find.own)||0;var diff=daysbetween(start,end);diff=diff+20;var year=diff/365;var selectedPcPlus=false;selects.forEach(function(select){if(select.toUpperCase().indexOf("BEST")>-1){sndata.data.recommendations.forEach(function(r){if(plusWarranty.includes(r.code)){selectedPcPlus=true}})}});if(selectedPcPlus==true){var removelist=[];selects.forEach(function(s2){if(s2.toUpperCase().indexOf("ADP")>-1||s2.toUpperCase().indexOf("SB")>-1){removelist.push(s2)}});removelist.forEach(function(x){selects.splice(selects.indexOf(x),1)})}rr=window.redportOption.click("CURRENT",currentDuration);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{var _loop=function(){var select=_step.value;var _jsService_duration;var duration=12*parseInt(select.substr(select.length-1,1));var name=select.substr(0,select.length-1);var jsService=sndata.data.jsServices.find(function(x){return sndata.data.level[x.name]==name});if(!jsService){return"continue"}var realName=jsService.name;var jsDurations=((_jsService_duration=jsService.duration)===null||_jsService_duration===void 0?void 0:_jsService_duration.filter(function(x){return x>jsService.own&&x<=maxDuration}))||[];if("good,better,best".indexOf(name)<0){var _rr_show_find;var showDuration=(rr===null||rr===void 0?void 0:(_rr_show_find=rr.show.find(function(x){return x.name==realName}))===null||_rr_show_find===void 0?void 0:_rr_show_find.duration)||0;jsDurations=jsDurations.filter(function(x){return x>jsService.own&&x<=maxDuration&&x<=showDuration})||[]}if(jsService.own>0&&jsService.own==duration){remarks.push("You already have "+jsService.own+"M "+realName)}else if(jsService.own>0&&jsService.own>duration){if("good,better,best".indexOf(name)>=0){remarks.push("Existing warranty is a higher level or maxed out already.")}else{remarks.push("Existing warranty is a higher level or maxed out "+realName+" already.")}}else if(jsDurations==0){remarks.push("No "+realName+" offerings")}else if(realName=="ISE"){var maxAddonDuration=["ADP","KYD","SB"].reduce(function(acc,cur){var _rr_select_find,_sndata_data_jsServices_find;return Math.max((rr===null||rr===void 0?void 0:(_rr_select_find=rr.select.find(function(x){return x.name==cur}))===null||_rr_select_find===void 0?void 0:_rr_select_find.duration)||0,((_sndata_data_jsServices_find=sndata.data.jsServices.find(function(x){return x.code==cur}))===null||_sndata_data_jsServices_find===void 0?void 0:_sndata_data_jsServices_find.own)||0,acc)},-1);if(maxAddonDuration>0&&jsDurations.includes(maxAddonDuration)&&hasPrice(sndata,realName,maxAddonDuration)){rr=window.redportOption.click(realName,duration)||rr}}else if(!jsDurations.includes(duration)||!hasPrice(sndata,realName,duration)){remarks.push("You want "+duration+"M. But we only have "+jsDurations.join("M,")+"M for "+realName)}else{rr=window.redportOption.click(realName,duration)||rr}};for(var _iterator=selects[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true)_loop()}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}if(rr){rr.select=rr.select.filter(function(x){return x.name!="CURRENT"})||[]}item.push({serialNumber:sndata.data.ibaseInfo.machineInfo.serial,machineType:sndata.data.ibaseInfo.machineInfo.type,productName:sndata.data.ibaseInfo.machineInfo.productName,status:rr!=null&&rr.select.length==selects.length?"Matched":"Not Matched",remark:remarks,pnList:[],select:(rr===null||rr===void 0?void 0:rr.select)||null,jsServices:sndata.data.jsServices,sndata:sndata.data});if(rr){var _iteratorNormalCompletion1=true,_didIteratorError1=false,_iteratorError1=undefined;try{var _loop1=function(){var show=_step1.value;var _jsService_duration;if(show.name=="CURRENT"){return"continue"}var name=sndata.data.level[show.name];var jsService=sndata.data.jsServices.find(function(x){return x.name==show.name});var jsDurations=((_jsService_duration=jsService.duration)===null||_jsService_duration===void 0?void 0:_jsService_duration.filter(function(x){return x>jsService.own&&x<=maxDuration&&x<=show.duration}))||[];var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=jsDurations[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var jsDuration=_step.value;if("good,better,best".indexOf(name)<0){var addonPrice=getAddonPrice(sndata,show.name,jsDuration);if(addonPrice>0){valid[name][jsDuration/12-1]++;price[name][jsDuration/12-1]+=addonPrice;if(isChargeRecertificationFee(sndata.data)&&(show.name=="ADP"||show.name=="ADPONE")){var recertification=sndata.data.others.find(function(z){return z.warrantyCode=="RECERTIFICATION"});price[name][jsDuration/12-1]+=recertification.price.includingTaxAndDiscountValue[0]||0}}}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}};for(var _iterator1=rr.show[Symbol.iterator](),_step1;!(_iteratorNormalCompletion1=(_step1=_iterator1.next()).done);_iteratorNormalCompletion1=true)_loop1()}catch(err){_didIteratorError1=true;_iteratorError1=err}finally{try{if(!_iteratorNormalCompletion1&&_iterator1.return!=null){_iterator1.return()}}finally{if(_didIteratorError1){throw _iteratorError1}}}}});return{"valid":valid,"item":item,"price":price}};bulkRedportOption.getResult=function(selects){var r=bulkRedportOption.run(selects);r.item.forEach(function(x){if(x.select){x.select.forEach(function(y){var duration=y.duration;x.sndata.warranties.forEach(function(w){setPN(x,y,w,duration)});x.sndata.addons.forEach(function(w){setPN(x,y,w,duration)})})}if(isChargeRecertificationFee(x.sndata)&&x.select&&x.select.some(function(y){return y.name=="ADP"||y.name=="ADPONE"})){var recertification=x.sndata.others.find(function(z){return z.warrantyCode=="RECERTIFICATION"});var tempPn={};tempPn.formatOriginalPrice="";tempPn.originalPrice=recertification.price.includingTaxValue[0];tempPn.formatPaidPrice="";tempPn.paidPrice=recertification.price.includingTaxAndDiscountValue[0];tempPn.term="";tempPn.startDate="";tempPn.endDate="";tempPn.description="Recertification Fee";tempPn.type=recertification.warrantyCode.toLowerCase();tempPn.partNumber=recertification.partNumber;x.pnList.push(tempPn)}var reinstatement=x.sndata.others.find(function(z){return z.warrantyCode=="REINSTATEMENT"});if(x.select&&x.select.length>0&&x.sndata.chargeReinstatementFee&&reinstatement){var tempPn={};tempPn.formatOriginalPrice="";tempPn.originalPrice=reinstatement.price.includingTaxValue[0];tempPn.formatPaidPrice="";tempPn.paidPrice=reinstatement.price.includingTaxAndDiscountValue[0];tempPn.term="";tempPn.startDate="";tempPn.endDate="";tempPn.description="Reinstatement Fee";tempPn.type=reinstatement.warrantyCode.toLowerCase();tempPn.partNumber=reinstatement.partNumber;x.pnList.push(tempPn)}});return r.item};function isChargeRecertificationFee(sndata){if(window.customData.recertificationFeeCountry.toUpperCase().indexOf(window.config.user.Country.toUpperCase())<0){return false}var recertification=sndata.others.find(function(x){return x.warrantyCode=="RECERTIFICATION"});if(!recertification){return false}if(sndata.chargeReinstatementFee){return false}var now=new Date(new Date().toISOString().substring(0,10));if(daysbetweenWithSign(now,new Date(sndata.ibaseInfo.machineInfo.baseStartDate))<=90){return false}if(sndata.jsServices.some(function(x){return x.own>0&&(x.name.toUpperCase()=="ADP"||x.name.toUpperCase()=="ADPONE")})){return false}return true}function setPN(x,y,w,duration){var isArrayPrice=_instanceof(w.price.includingTaxAndDiscountValue,Array);var offset=w.price.indexOffset;if(w.warrantyCode==y.name){var tempPn={};tempPn.formatOriginalPrice="";tempPn.originalPrice=isArrayPrice?w.price.includingTaxValue[duration-offset-1]:w.price.includingTaxValue[duration];tempPn.formatPaidPrice="";tempPn.paidPrice=isArrayPrice?w.price.includingTaxAndDiscountValue[duration-offset-1]:w.price.includingTaxAndDiscountValue[duration];tempPn.term=duration-offset;tempPn.startDate=w.startDate;tempPn.endDate=isArrayPrice?w.price.endDate[duration-offset-1]:w.price.endDate[duration];var name=x.name;var off=0;x.sndata.jsServices.forEach(function(js){if(js.own>0&&"GOOD,BETTER,BEST".indexOf(x.sndata.level[js.code].toUpperCase())>=0){var baseStart=new Date(x.sndata.ibaseInfo.baseWarranties[0].startDate);var today=new Date;for(var i=1;i<=js.own;i++){var newDate=new Date(baseStart.setMonth(baseStart.getMonth()+1));if(newDate>today){off=js.own-(i-1);break}}}});if(x.sndata.level[x.sndata.ibaseInfo.currentWarranty.deliveryType]==x.sndata.level[w.warrantyCode]){off=off+tempPn.term}else if(x.sndata.level[x.sndata.ibaseInfo.currentWarranty.deliveryType]>x.sndata.level[w.warrantyCode]){off=tempPn.term}else if("GOOD.BETTER.BEST".indexOf(x.sndata.level[w.warrantyCode])<0){off=tempPn.term}if(x.sndata.oow){off=tempPn.term}tempPn.description=y.name+" x "+tempPn.term+" Months ("+off+" months remaining)";tempPn.type=w.warrantyCode.toLowerCase();tempPn.partNumber=w.partNumber;if(duration-offset-1>0)x.pnList.push(tempPn)}}function daysbetween(d1,d2){var oneDay=24*60*60*1e3;var firstDate=new Date(d1);var secondDate=new Date(d2);var diffDays=Math.round(Math.abs((firstDate-secondDate)/oneDay));return diffDays}function daysbetweenWithSign(d1,d2){var oneDay=24*60*60*1e3;var firstDate=new Date(d1);var secondDate=new Date(d2);var diffDays=Math.round((firstDate-secondDate)/oneDay);return diffDays}function hasPrice(sndata,name,duration){return getWarrantyPrice(sndata,name,duration)>0||getAddonPrice(sndata,name,duration)>0}function getWarrantyPrice(sndata,name,duration){if(!name){return 0}var matchWarranty=sndata.data.warranties.find(function(z){return z.warrantyCode==name});if(!matchWarranty){return 0}return matchWarranty.price.includingTaxAndDiscountValue[duration]||0}function getAddonPrice(sndata,name,duration){if(!name){return 0}var matchAddon=sndata.data.addons.find(function(z){return z.warrantyCode==name});if(!matchAddon){return 0}return matchAddon.price.includingTaxAndDiscountValue[duration]||0}})(bulkRedportOption);