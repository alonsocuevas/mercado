var serviceOption={};(function(serviceOption){if(!String.prototype.includes){Object.defineProperty(String.prototype,"includes",{configurable:true,writable:true,enumerable:false,value:function includes(search,start){"use strict";if(typeof start!=="number"){start=0}if(start+search.length>this.length){return false}else{return this.indexOf(search,start)!==-1}}})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{configurable:true,writable:true,enumerable:false,value:function includes(valueToFind,fromIndex){if(this==null){throw new TypeError('"this" is null or not defined')}var o=Object(this);var len=o.length>>>0;if(len===0){return false}var n=fromIndex|0;var k=Math.max(n>=0?n:len-Math.abs(n),0);function sameValueZero(x,y){return x===y||typeof x==="number"&&typeof y==="number"&&isNaN(x)&&isNaN(y)}while(k<len){if(sameValueZero(o[k],valueToFind)){return true}k++}return false}})}if(!Array.from){Object.defineProperty(Array,"from",{configurable:true,writable:true,enumerable:false,value:function(){var toStr=Object.prototype.toString;var isCallable=function isCallable(fn){return typeof fn==="function"||toStr.call(fn)==="[object Function]"};var toInteger=function toInteger(value){var number=Number(value);if(isNaN(number)){return 0}if(number===0||!isFinite(number)){return number}return(number>0?1:-1)*Math.floor(Math.abs(number))};var maxSafeInteger=Math.pow(2,53)-1;var toLength=function toLength(value){var len=toInteger(value);return Math.min(Math.max(len,0),maxSafeInteger)};return function from(arrayLike){var C=this;var items=Object(arrayLike);if(arrayLike==null){throw new TypeError("Array.from requires an array-like object - not null or undefined")}var mapFn=arguments.length>1?arguments[1]:void undefined;var T;if(typeof mapFn!=="undefined"){if(!isCallable(mapFn)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){T=arguments[2]}}var len=toLength(items.length);var A=isCallable(C)?Object(new C(len)):new Array(len);var k=0;var kValue;while(k<len){kValue=items[k];if(mapFn){A[k]=typeof T==="undefined"?mapFn(kValue,k):mapFn.call(T,kValue,k)}else{A[k]=kValue}k+=1}A.length=len;return A}}()})}serviceOption.filterAddon=function(orgResponseData,pn){var result={needDisplayed:[],canBeSelected:[],locked:[],selected:[],selectedWarranty:null};if(this.addonOrderInit===undefined&&orgResponseData.addons!=undefined&&orgResponseData.addons&&orgResponseData.addons.length>1){orgResponseData.addons.map(function(m){if(m.warrantyCode=="ISE"){m.sortCode="ZZZ"}else{m.sortCode=m.warrantyCode}});orgResponseData.addons.sort(function(a,b){if(a.sortCode<b.sortCode){return-1}if(a.sortCode>b.sortCode){return 1}return 0});this.addonOrderInit=true}var responseData=JSON.parse(JSON.stringify(orgResponseData));if(responseData&&responseData.addons){if(!pn||pn=="BASE"){result=_getAddonForCurrentWarranty(responseData);delete window["lastSelectedAddons"];delete window["lastSelectedWarrantyPn"]}else{var isWarranty=responseData.warranties.filter(function(warranty){return warranty.partNumber==pn}).length>0;if(isWarranty){if(window["lastSelectedWarrantyPn"]==pn){delete window["lastSelectedWarrantyPn"];result=_getAddonForCurrentWarranty(responseData)}else{window["lastSelectedWarrantyPn"]=pn;result=_getAddonForSpecificWarranty(responseData,pn)}if(result.locked&&result.locked.length>0)window["lastSelectedAddons"]=result.locked.map(function(locaked){return locaked.partNumber});else delete window["lastSelectedAddons"]}else{result=window["lastSelectedWarrantyPn"]?_getAddonForSpecificWarranty(responseData,window["lastSelectedWarrantyPn"]):_getAddonForCurrentWarranty(responseData);if(window["lastSelectedAddons"]&&window["lastSelectedAddons"].includes(pn))window["lastSelectedAddons"]=window["lastSelectedAddons"].filter(function(selectedAddon){return selectedAddon!=pn});else{if(window["lastSelectedAddons"]==null)window["lastSelectedAddons"]=[];window["lastSelectedAddons"].push(pn)}result.locked=result.locked.filter(function(x){if(x.warrantyCode==="ISE"){var hasISE=false;window["lastSelectedAddons"].filter(function(addonpn){var addon=null;responseData.addons.filter(function(temp){if(temp.partNumber===addonpn){addon=temp}return true});if(addon.warrantyCode=="ISE")hasISE=true;return true});return hasISE}return window["lastSelectedAddons"].indexOf(x.partnumber)>=0})}}}if(window["lastSelectedAddons"]&&window["lastSelectedAddons"].length>0){var selectedDependencies=responseData.addons.filter(function(addon){if(addon.dependencies){var include=false;window["lastSelectedAddons"].concat(result.locked.map(function(lockedAddon){return lockedAddon.partNumber})).some(function(selectedAddon){if(addon.dependencies.includes(selectedAddon))include=true;return include==true});return include}return false});result.needDisplayed=result.needDisplayed.concat(selectedDependencies);result.canBeSelected=result.canBeSelected.concat(selectedDependencies);if(result.locked&&result.locked.length>0){selectedDependencies.map(function(selectedAddon){var addons=result.locked.filter(function(lockedAddon){return lockedAddon.warrantyCode==selectedAddon.warrantyCode});if(addons&&addons.length>0){if(selectedAddon.unitTerm>addons[0].unitTerm){addons[0].unitTerm=selectedAddon.unitTerm;addons[0].partNumber=selectedAddon.partNumber}}})}}result.locked=_distinct(_filterArray(result.locked,responseData));result.needDisplayed=_distinct(_filterArray(result.needDisplayed,responseData));result.canBeSelected=_distinct(_filterArray(result.canBeSelected,responseData));result.needDisplayed=_distinct(result.needDisplayed.concat(result.canBeSelected));result.selectedWarranty=window["lastSelectedWarrantyPn"]?window["lastSelectedWarrantyPn"]:"BASE";result.selected=window["lastSelectedAddons"]&&window["lastSelectedAddons"].length>0?window["lastSelectedAddons"]:[];result.selected=result.selected.filter(function(item){return result.needDisplayed.includes(item)});if(result.locked&&result.locked.length>0){result.selected=_distinct(result.selected.concat(result.locked))}result.selected=_clearInvalidSelected(responseData.addons,result.selected,result.selectedWarranty);if(responseData.optionsSetting&&responseData.optionsSetting.mandatoryBundle&&responseData.optionsSetting.iseNeedBundle&&result.selected&&result.selected.length>0){var iseDependencyAddons=responseData.addons.filter(function(addon){return result.selected.includes(addon.partNumber)&&responseData.optionsSetting.iseBundlesWithTypes.includes(addon.warrantyCode)});if(iseDependencyAddons!=null&&iseDependencyAddons.length>0){var unitTerm=iseDependencyAddons[0].unitTerm;var ise=responseData.addons.filter(function(addon){return addon.warrantyCode=="ISE"&&addon.unitTerm==unitTerm});if(ise&&ise.length>0&&result.needDisplayed.includes(ise[0].partNumber)){result.locked.push(ise[0].partNumber);result.selected.push(ise[0].partNumber)}}}if(responseData.optionsSetting&&responseData.optionsSetting.iseBundlesWithTypes&&responseData.optionsSetting.iseBundlesWithTypes.length>0){var maxTerm=Math.max.apply(Math,responseData.addons.filter(function(addon){return result.selected.includes(addon.partNumber)&&responseData.optionsSetting.iseBundlesWithTypes.includes(addon.warrantyCode)}).map(function(selectedAddon){return selectedAddon.unitTerm}));var maxTermIses=responseData.addons.filter(function(addon){return addon.warrantyCode=="ISE"&&addon.unitTerm==maxTerm});if(maxTermIses&&maxTermIses.length>0){maxTermIse=maxTermIses[0];var beforeLength=result.needDisplayed.length;result.needDisplayed=responseData.addons.filter(function(addon){return result.needDisplayed.includes(addon.partNumber)}).filter(function(displayedAddon){return displayedAddon.warrantyCode!="ISE"}).map(function(m){return m.partNumber});if(beforeLength!=result.needDisplayed.length)result.needDisplayed.push(maxTermIse.partNumber);beforeLength=result.canBeSelected.length;result.canBeSelected=responseData.addons.filter(function(addon){return result.canBeSelected.includes(addon.partNumber)}).filter(function(canBeSelectedAddon){return canBeSelectedAddon.warrantyCode!="ISE"}).map(function(m){return m.partNumber});if(beforeLength!=result.canBeSelected.length)result.canBeSelected.push(maxTermIse.partNumber);beforeLength=result.locked.length;result.locked=responseData.addons.filter(function(addon){return result.locked.includes(addon.partNumber)}).filter(function(lockedAddon){return lockedAddon.warrantyCode!="ISE"}).map(function(m){return m.partNumber});if(beforeLength!=result.locked.length)result.locked.push(maxTermIse.partNumber);beforeLength=result.selected.length;result.selected=responseData.addons.filter(function(addon){return result.selected.includes(addon.partNumber)}).filter(function(selectedAddon){return selectedAddon.warrantyCode!="ISE"}).map(function(m){return m.partNumber});if(beforeLength!=result.selected.length)result.selected.push(maxTermIse.partNumber)}}result.selected=_distinct(result.selected.concat(result.locked));window["lastSelectedAddons"]=result.selected;result.locked=[];return result};_getAddonForCurrentWarranty=function _getAddonForCurrentWarranty1(responseData){var result={needDisplayed:[],canBeSelected:[],locked:[]};if(responseData.addons&&responseData.addons.length>0){var dependenciesAddon=responseData.addons.filter(function(item){return item.dependencies&&item.dependencies.includes("BASE")});result.needDisplayed=_recursiveGetDependencies(responseData.addons,dependenciesAddon);result.canBeSelected=dependenciesAddon}return result};_getAddonForSpecificWarranty=function _getAddonForSpecificWarranty1(responseData,pn){var result={needDisplayed:[],canBeSelected:[],locked:[]};if(pn){var selectedWarranties=responseData.warranties.filter(function(item){return item.partNumber==pn});if(selectedWarranties&&selectedWarranties.length>0){var selectedWarranty=selectedWarranties[0];result.canBeSelected=responseData.addons.filter(function(item){return item.dependencies&&item.dependencies.includes(pn)});result.needDisplayed=_recursiveGetDependencies(responseData.addons,result.canBeSelected);if(responseData.optionsSetting&&responseData.optionsSetting.mandatoryBundle&&selectedWarranty.bundles&&selectedWarranty.bundles.length>0){result.locked=responseData.addons.filter(function(item){return selectedWarranty.bundles.includes(item.partNumber)})}}}return result};_filterArray=function _filterArray1(addons,responseData){var tempList=[];addons.map(function(m){var addon=tempList.filter(function(f){return f.warrantyCode==m.warrantyCode});if(responseData.optionsSetting&&responseData.optionsSetting.durationNeedAline&&addon&&addon.length>0){if(m.unitTerm>addon[0].unitTerm){addon[0].unitTerm=m.unitTerm;addon[0].partNumber=m.partNumber}}else{tempList.push(m)}});return tempList.map(function(temp){return temp.partNumber})};_recursiveGetDependencies=function _recursiveGetDependencies1(addons,dependenciesAddon){var result=[];if(addons&&addons.length>0&&dependenciesAddon&&dependenciesAddon.length>0){result=result.concat(dependenciesAddon);if(result.length>0){var _loop=function(){var addNumber=0;result.map(function(r){var dependencies=addons.filter(function(addon){return addon.dependencies&&addon.dependencies.includes(r.partNumber)});if(dependencies.length>0){dependencies.forEach(function(f){var exists=result.filter(function(item){return item.partNumber==f.partNumber}).length>0;if(!exists){result.push(f);addNumber++}})}});if(addNumber==0)needBreak=true};var needBreak=false;while(!needBreak)_loop()}}return result};_clearInvalidSelected=function _clearInvalidSelected1(addons,selected,selectedWarranty){var needBreak=false;if(addons&&addons.length>0){var _loop=function(){var needRemoveIds=[];selected.map(function(s){var selectedAddons=addons.filter(function(a){return a.partNumber==s});if(selectedAddons&&selectedAddons.length>0){var dependencies=selectedAddons[0].dependencies;if(dependencies&&dependencies.length>0){var exists=dependencies.includes(selectedWarranty);if(!exists){dependencies.some(function(dependencyPartNumber){exists=selected.filter(function(partNumber){return partNumber==dependencyPartNumber}).length>0;return exists==true})}if(!exists)needRemoveIds.push(s)}}else needRemoveIds.push(s)});if(needRemoveIds.length>0)selected=selected.filter(function(f){return!needRemoveIds.includes(f)});else needBreak=true};while(!needBreak)_loop()}return selected};_distinct=function _distinct1(arr){arr=arr||[];var newArr=[];arr.forEach(function(item){if(newArr.indexOf(item)===-1)newArr.push(item)});return newArr}})(serviceOption);