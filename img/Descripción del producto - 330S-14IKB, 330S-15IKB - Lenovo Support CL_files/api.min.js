!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e={en:{"get code":"Get Code",submit:"Submit","2 step verification":"2-Step Verification","2 step verification desctiption":"This extra step shows it's really you trying to sign in","get code from otp":"Get a verification code from your authenticator app and enter it below.","verification code":"Verification Code","invalid verification code":"Invalid verification code.","network error":"Network Error, please try again later.","verification code required":"Verification code required"},zc:{"get code":"获取验证码",submit:"提交","2 step verification":"2-Step Verification","2 step verification desctiption":"This extra step shows it's really you trying to sign in","get code from otp":"Get a verification code from your authenticator app and enter it below.","verification code":"验证码","invalid verification code":"无效验证码","network error":"网络错误。请稍后再试","verification code required":"需要验证码"},ja:{"get code":"Get Code",submit:"送信","2 step verification":"2-Step Verification","2 step verification desctiption":"This extra step shows it's really you trying to sign in","get code from otp":"Get a verification code from your authenticator app and enter it below.","verification code":"認証コード","invalid verification code":"認証コードが無効です","network error":"ネットワークエラーです。あとでお試しください。","verification code required":"認証コードを入力してください"}};var n,o={init:function(n){return function(o){var t=e[n];t||(t=e.en);var i=t[o];return i||"#".concat(i)}}},t="https://account.lenovo.com",i=null,a=null,r=180;["dit","uat","perf"].some((function(e){return location.host.startsWith(e)}))&&(t="https://uataccount.lenovo.com");var s={options:{mfalist:[],id:"lenovo-mfa-box",boxStyle:"z-index:99999;width: 100%; height: 100%; position: fixed; top: 0; left: 0; background: rgba(0,0,0,0.5);display:block;",realm:"support.lenovo.com",api:{getMfalist:t+"/api/v3/lenovoid/mfa/list",sendcode:t+"/api/v3/lenovoid/mfa/sendcode",validCode:t+"/api/v3/lenovoid/mfa/verifyCode"},preMfaCode:"",userName:"",lang:"en",success:function(e){},fail:function(e){},beforeOpen:function(){},opened:function(){}},init:function(e){s.options=Object.assign(s.options,e),n=o.init(s.options.lang),"function"==typeof s.options.beforeOpen&&s.options.beforeOpen(),0===s.options.mfalist.length?s.loadMfalist().then((function(){return s.render()})):s.render()},loadMfalist:function(){return $.ajax({type:"POST",url:s.options.api.getMfalist,contentType:"application/json; charset=utf-8",data:JSON.stringify({preMfaCode:s.options.preMfaCode,realm:s.options.realm}),dataType:"json"}).then((function(e){s.options.mfalist=(e.data.mfaList||[]).filter((function(e){return e.defaultType}))}))},render:function(){s.options.mfalist=s.options.mfalist.filter((function(e){return e.defaultType})),document.getElementById(s.options.id)&&document.getElementById(s.options.id).remove();var e=document.createElement("div");e.id=s.options.id,e.style=s.options.boxStyle,document.body.append(e);var o=document.getElementById(s.options.id),t="",i=[],a=s.options.mfalist.length,c=0;s.options.mfalist.forEach((function(e){var n=e.userName?e.userName.replace(e.userName.slice(0,4),"****"):e.userName;c=e.mfaType,1==a?t='<b class="lenovo-mfa-text" value="'.concat(e.userName,'">').concat(n,"</b>"):i.push('<option value="'.concat(e.userName,'">').concat(n,"</option>"))})),a>1&&(t='<select id="lenovo-mfa-sendType">\n                    '.concat(i.join(""),"\n                </select>"));var l='\n    <style>\n      #lenovo-mfa-sendType,#lenovo-mfa-code {\n        height: 34px;\n        font-family: "museo_sans300";\n        border-radius: 3px; \n        padding: 0 10px;\n        border: 1px solid #666;\n      }\n      #lenovo-mfa-sendType,#lenovo-mfa-code {\n        width: 210px; \n      }\n      #lenovo-mfa-code.has-error {\n        border-color: #c51010;\n      }\n      .lenovo-mfa-msg {\n        color: #c51010;\n        font-size: 12px;\n        padding-top: 5px;\n        font-family: "museo_sans500";\n      }\n      #lenovo-mfa-sendType:focus,#lenovo-mfa-code:focus{\n        border-color: #000;\n      }\n      .lenovo-mfa-text {\n        font-weight: bold;\n      }\n      .lenovo-mfa-btn:hover {\n        background: #eaedf4; \n        color: #1976a1;\n      }\n      .lenovo-mfa-btn {\n        width: 100px; \n        height: 34px;\n        background: #294e95; \n        color: #fff; \n        padding: 0 10px;\n        border-radius: 4px; \n        font-family: "museo_sans500";\n        cursor: pointer; \n        border: 1px solid #294e95!important;\n        margin-left: 10px;\n        position:relative;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n      }\n      .lenovo-mfa-btn.disabled {\n        cursor: not-allowed;\n      }\n      .lenovo-mfa-timer {\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        background: rgba(255,255,255,0.8); \n        border-radius: 4px; \n        z-index: 1;\n        display: none;\n        top: 0;\n        left: 0;\n        color: #1976a1;\n        line-height: 34px;\n        font-family: "museo_sans500";\n      }\n      .lenovo-mfa-btn.disabled>.lenovo-mfa-timer {\n        display: block;\n      }\n      .lenovo-mfa-title {\n        font-family: "museo_sans500";\n        font-size: 24px;\n        color: #333;\n        margin: 10px 0 0;\n        font-weight: normal;\n      }\n      .mfa-text {\n        margin-top: 20px;\n        color: #666;\n        font-size: 14px;\n        font-family: "museo_sans500";\n      }\n      .lenovo-mfa-dialog {\n        text-align: center;\n        background-color: #fff;\n        border-radius: 10px;\n        width: 400px;\n        height: 260px;\n        margin: auto;\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        padding: 20px 25px;\n        box-shadow: 1px 1px 4px 0px #ddd;\n        font-family: "museo_sans500";\n      }\n\n      #lenovo-mfa-close {\n        font-size: 18px;\n        position: absolute;\n        top: 5px;\n        right: 10px;\n        cursor: pointer;\n      }\n\n      #lenovo-mfa-close:hover {\n        color: #294e95;\n      }\n\n      .lenovo-mfa-text + .lenovo-mfa-btn {\n        border: none!important;\n        background: none;\n        color: #294e95;\n        font-weight: bold;\n        height: auto;\n        padding-top: 5px;\n      }\n\n      .lenovo-mfa-text + .lenovo-mfa-btn >.lenovo-mfa-timer {\n        line-height: normal;\n      }\n\n      .lenovo-mfa-text + .lenovo-mfa-btn:hover {\n        color: #1976a1;\n      }\n\n      #lenovo-mfa-box ul,#lenovo-mfa-box li {\n        margin: 0;\n        padding: 0;\n        list-style: none;\n      }\n      \n    </style>\n    <div class="lenovo-mfa-dialog">\n      <b id="lenovo-mfa-close">&times;</b>\n      <h2 class="lenovo-mfa-title">'.concat(n("2 step verification"),'</h2>\n      <p class="mfa-text">').concat(n("2 step verification desctiption"),'</p>\n      <ul style="padding: 20px 10px;text-align: left;list-style: none;margin:0;">\n          <li>\n              ').concat(t,"\n              ").concat(2!=c?'<button class="lenovo-mfa-btn" id="lenovo-mfa-sendCode">'.concat(n("get code"),'\n                <span id="lenovo-mfa-sendCode-timer" class="lenovo-mfa-timer">').concat(r,"s</span>\n              </button>"):'<p class="mfa-text">'.concat(n("get code from otp"),"</p>"),'\n          </li>\n          <li style="margin-top: 25px;">\n              <input type="text" id="lenovo-mfa-code" placeholder="').concat(n("verification code"),'" value=""/>\n              <button class="lenovo-mfa-btn" id="lenovo-mfa-submit">\n                ').concat(n("submit"),'\n                <span id="lenovo-mfa-submit-timer" class="lenovo-mfa-timer">').concat(r,'s</span>\n              </button>\n          </li>\n          <li class="lenovo-mfa-msg"></li>\n      </ul>\n    </div>\n    ');o.innerHTML=l,document.getElementById("lenovo-mfa-sendCode")&&document.getElementById("lenovo-mfa-sendCode").addEventListener("click",s.sendCode),document.getElementById("lenovo-mfa-submit").addEventListener("click",s.validCode),document.getElementById("lenovo-mfa-close").addEventListener("click",s.close),"function"==typeof s.options.opened&&s.options.opened()},sendCode:function(){if(i)return!1;s.createSendCodeTimer();var e=s.getSelectMfa();$.ajax({type:"POST",url:s.options.api.sendcode,contentType:"application/json; charset=utf-8",data:JSON.stringify({userName:e.userName,areaCode:e.areaCode,type:16,lang:s.options.lang,realm:s.options.realm}),dataType:"json"}).then((function(e){}))},createSendCodeTimer:function(e){document.getElementById("lenovo-mfa-sendCode").className="lenovo-mfa-btn disabled";var n=e||r;document.getElementById("lenovo-mfa-sendCode-timer").innerHTML="".concat(n,"s"),i=setInterval((function(){n--,document.getElementById("lenovo-mfa-sendCode-timer").innerHTML="".concat(n,"s"),0===n&&s.clearSendCodeTimer()}),1e3)},clearSendCodeTimer:function(){clearInterval(i),i=null,document.getElementById("lenovo-mfa-sendCode").className="lenovo-mfa-btn"},validCode:function(){if(s.hideError(),a)return!1;var e=document.getElementById("lenovo-mfa-code").value.trim();if(!e)return s.showError(n("verification code required")),!1;s.hideError(),s.createVerificationCodeTimer();var o=s.getSelectMfa();$.ajax({type:"POST",url:s.options.api.validCode,contentType:"application/json; charset=utf-8",data:JSON.stringify({userName:o.userName,deviceId:window.DeviceId||s.randomId(),verifyCode:e,authType:o.mfaType,preMfaCode:s.options.preMfaCode,realm:s.options.realm,areaCode:o.areaCode}),dataType:"json"}).then((function(e){if("function"==typeof s.options.success)if(e.data)s.options.success(e.data),s.close();else{s.clearVerificationCodeTimer();var n=s.getMfaValidateFailMessage(e.statusCode);s.showError(n),s.options.fail(e)}})).fail((function(e){return s.options.fail(e)}))},createVerificationCodeTimer:function(e){document.getElementById("lenovo-mfa-submit").className="lenovo-mfa-btn disabled";var n=e||r;document.getElementById("lenovo-mfa-submit-timer").innerHTML="".concat(n,"s"),a=setInterval((function(){n--,document.getElementById("lenovo-mfa-submit-timer").innerHTML="".concat(n,"s"),0===n&&s.clearVerificationCodeTimer()}),1e3)},clearVerificationCodeTimer:function(){clearInterval(a),a=null,document.getElementById("lenovo-mfa-submit").className="lenovo-mfa-btn"},getSelectMfa:function(){if(1==s.options.mfalist.length)return s.options.mfalist[0];var e=document.getElementById("lenovo-mfa-sendType"),n=e.options[e.selectedIndex].value;return s.options.mfalist.find((function(e){return e.userName==n}))},close:function(){document.getElementById(s.options.id).style="display:none",document.getElementById("lenovo-mfa-code").value="",s.hideError(),s.clearVerificationCodeTimer(),s.clearSendCodeTimer()},showError:function(e){document.getElementById("lenovo-mfa-code").className="has-error",$(".lenovo-mfa-msg").text(e).show()},hideError:function(){document.getElementById("lenovo-mfa-code").className="",$(".lenovo-mfa-msg").text("").hide()},randomId:function(){var e=localStorage.getItem("randomId");if(e)return e;for(var n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",o="",t=32;t>0;--t)o+=n[Math.floor(62*Math.random())];return localStorage.setItem("randomId",o),o},getMfaValidateFailMessage:function(e){return n("invalid verification code")}};window.Lenovo_MFA=s;var c={options:{passport:{stAccess:"https://passport.lenovo.com/glbwebauthnv6/stAccessLogin",logout:"https://passport.lenovo.com/glbwebauthnv6/gateway?lenovoid.action=uilogout&lenovoid.realm=",lenovoIdJs:"https://passport.lenovo.com/glbwebauthnv6/wauth/js/LenovoId.js",syncCookie:"https://passport.lenovo.com/glbwebauthnv6/synCookie.jhtml?lenovoid_realm=",clientid:"https://passport.lenovo.com/utils/lenovoid-Bid.js"},realm:"support.lenovo.com",mfa:"",login:!1,success:function(e){},error:function(e){}},init:function(e){if(c.options=Object.assign(c.options,e),!c.options.login){window.LenovoIdSyncLoginState=this.LenovoIdSyncLoginState;var n=c.options.passport,o=this;this.loadJs(n.lenovoIdJs).then((function(){o.loadJs(n.syncCookie+e.realm+"&lenovoid_mfa="+e.mfa).catch((function(e){}))})).catch((function(e){}))}},loadJs:function(e){return new Promise((function(n,o){var t=document.createElement("script");t.src=e,t.type="text/javascript",t.attachEvent&&t.attachEvent("onload",(function(e){n(e)})),t.addEventListener?t.addEventListener("load",(function(e){n(e)}),!1):t.onload=function(e){n(e)},document.getElementsByTagName("head")[0].appendChild(t)}))},buildIFrame:function(e,n){return new Promise((function(o,t){var i=document.createElement("iframe");i.src=n,i.style.display="none",i.id=e,i.setAttribute("sandbox","allow-same-origin allow-scripts"),i.attachEvent?i.attachEvent("onload",(function(e){o(e)})):i.onload=function(e){o(e)},document.body.appendChild(i)}))},LenovoIdSyncLoginState:function(e){try{var n=JSON.parse(e);"200"===n.Code?"function"==typeof c.options.success&&c.options.success(n.wust):"USS-0550"===n.Code&&Lenovo_MFA&&Lenovo_MFA.init()}catch(o){}},setAccess:function(e,n,o){var t=this,i=c.options;return new Promise((function(a,r){if(t.isNullOrEmpty(o)){var s="".concat(i.passport.stAccess,"?realm=").concat(i.realm,"&wust=").concat(o,"&username=").concat(n,"&state_time=").concat(e);t.buildIFrame("set_lenovoid",s).then((function(){a(!0)}))}else a(!0)}))},logout:function(){var e=c.options;return new Promise((function(n,o){c.buildIFrame("logout_cookie",e.passport.logout+e.realm).then((function(){n(!0)}))}))},isNullOrEmpty:function(e){return null!=e&&null!=e&&""!=e},getDeviceId:function(){return new Promise((function(e,n){lenovoidBid.get((function(n){var o=lenovoidBid.x64hash128(n.map((function(e){return e.value})).join(),31);e(o)}))}))}};c.loadJs(c.options.passport.clientid).then((function(){c.getDeviceId().then((function(e){window.DeviceId=e}))})),window.LenovoSSO=c}));
