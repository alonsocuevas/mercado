(function($1,window1){var $lenaBotWindow=$1("#lena-bot-window");var $window=$1(window1);var generateDeferred=$1.Deferred();$window.data("lenaBot.initted",false);if(!$lenaBotWindow.length){return}if((navigator.userAgent||"").toLowerCase().indexOf("lenovovantage")>-1){return}var lenaBotHtml=['<link href="/esv4/plugins/contactus/lena-bot/index.css" rel="stylesheet" />','<div class="lenaBotWindow" style="display: none">','<p class="close-btn icon-s-close" id="moli_close_btn"></p>','<div class="hovertext">','<p t="lena chatbot tool tip|Lenovo Virtual Agent Lena can help troubleshoot issues with your PC product."></p>',"</div>",'<p class="moli-lets-chat moli-msg" t="how can i help you|How can I help you?">How can I help you?</p>','<img src="/esv4/plugins/contactus/lena-bot/lena-new.png" class="lenaImg" alt="lena">',"</div>"];var methods={initted:false,isAvailable:false,caches:{},lenaTrack:function lenaTrack(){var track=methods.mb(["_satellite","track"])(window1);if(track){var obj={type:"eSupportProcess_Complete",name:"Lena ChatBot Robot Click",action:"Click"};l.DTM.Lmd.push(obj)}},inlineLenaTrack:function inlineLenaTrack(action,type){var lmd=methods.mb(["lmd"])(window1);var _satellite=methods.mb(["_satellite"])(window1);if(lmd&&_satellite&&_satellite.track){if(action==="click"){lmd.customInteraction="inline_lena: ".concat(type,": ").concat(action);_satellite.track("support_custom_interaction");return}lmd.customInteraction="inline_lena: ".concat(action);_satellite.track("support_custom_interaction")}},mb:function mb(p){return function(o){return p.map(function(c){return o=(o||{})[c]})&&o}},initLenaBotEvents:function initLenaBotEvents($container,config){$container.off("click.openWindow").on("click.openWindow","div.hovertext,img.lenaImg,p.moli-msg",function(){methods.openLenaWindow(config.url)});$container.off("click.hide").on("click.hide",".close-btn",function(){methods.hideWindow();$lenaBotWindow.hide();methods.markLenaBotClosedManually()})},markLenaBotClosedManually:function markLenaBotClosedManually(){$lenaBotWindow.data("closedManually",true);try{sessionStorage.setItem("com.lenovo.support.lena-bot.closedManually","1")}catch(e){}},isLenaBotClosedManually:function isLenaBotClosedManually(){try{return!!($lenaBotWindow.data("closedManually")||sessionStorage.getItem("com.lenovo.support.lena-bot.closedManually"))}catch(e){}return false},isLenaBotShown:function isLenaBotShown(){return $1(".lenaBotWindow",$lenaBotWindow).is(":visible")},openLenaWindow:function openLenaWindow(url){var win=window1.open(url,"_blank");win.focus();methods.lenaTrack()},showWindow:function showWindow(forced){if(!forced&&methods.isLenaBotClosedManually()){return}if(methods.isLenaBotShown()&&methods.isAvailable){return}if(!!$1("#yes-no-survey-suspended").length){$1(".lenaBotWindow").css("bottom","80px")}else{$1(".lenaBotWindow").css("bottom","20px")}$lenaBotWindow.show();$1(".lenaBotWindow",$lenaBotWindow).show()},hideWindow:function hideWindow(){$1(".lenaBotWindow",$lenaBotWindow).hide()},hideInlineLena:function hideInlineLena(){if(window1.kdBotSDK&&window1.kdBotSDK.minimize){window1.kdBotSDK.minimize();$1("#kd-bot-app .kd-chat-icon").addClass("hide")}window1.lenaURL=""},init:function init(){$window.on("pspSectionChanged",function(){if(methods.isLenaBotClosedManually()){return}methods.hideInlineLena();setTimeout(function(){methods.initNewLenaChat()},1500)});$window.on("lenaBot.appendGenerateCb",function(e,callback){return generateDeferred.then(callback)});$window.on("lenaBot.checkInitted",function(e,callback){$window.data("lenaBot.initted",methods.initted);return callback(methods.initted)});methods.initNewLenaChat().always(function(){window1.LenaBotChat=window1.LenaBotChat||methods.initNewLenaChat;methods.initted=true;$window.data("lenaBot.initted",methods.initted);$window.trigger("lenaBot.initted")})},initNewLenaChatCallback:function initNewLenaChatCallback(res,options){if(options.source!==window1.location.href){return}if(methods.mb(["status"])(res)!=="success"){methods.hideInlineLena();return methods.hideWindow()}var isAvailable=!!methods.mb(["data","available"])(res);var url=methods.mb(["data","url"])(res);var stayTimeToShow=methods.mb(["data","stayTimeToShow"])(res)|0;var enableInlineVersion=methods.mb(["data","enableInlineVersion"])(res);methods.isAvailable=isAvailable;if(!(isAvailable&&url)){methods.hideInlineLena();methods.inlineLenaTrack("disableInlineLena","");return methods.hideWindow()}methods.inlineLenaTrack("enableInlineLena","");var config={url:url,isAvailable:isAvailable,stayTimeToShow:stayTimeToShow};window1.lenaURL=url;if(enableInlineVersion&&url){var originQueryData=url.split("&data=")[1];var deBase64QueryData="";try{deBase64QueryData=atob(originQueryData)}catch(e){}if($1("#kd-bot-app").length){window1.haveSmartAvatarTab=window1.haveSmartAvatarTab||[];if(window1.haveSmartAvatarTab.indexOf(window1.recodeClick||"")==-1&&!$1(".smartAvatar_operation").hasClass("cookieConsentToolimit")){$1("#kd-bot-app .kd-chat-icon").removeClass("hide");methods.inlineLenaTrack("display","")}else{methods.inlineLenaTrack("hideInlineLena","")}return}kdBotSDK=null;var inlineLenaUrl=window1.customData.inlineLenaUrl||"https://us-llm.lena.lenovo.com/inline/js/kd-bot-plugins.umd.cjs";var currentCountry=l.CultureUtility.getCurrentCountry().toLowerCase();$1.getScript(inlineLenaUrl).done(function(){var siteParams={referenceUrl:methods.getQueryStringFormTargetSearch(deBase64QueryData,"ReferenceUrl"),referenceName:window1.mse_tabs||"",brand:methods.getQueryStringFormTargetSearch(deBase64QueryData,"Brand"),serialNumber:methods.getQueryStringFormTargetSearch(deBase64QueryData,"SerialNumber"),specialSupport:methods.getQueryStringFormTargetSearch(deBase64QueryData,"SpecialSupport"),warrantyStatus:methods.getQueryStringFormTargetSearch(deBase64QueryData,"WarrantyStatus"),countryCode:methods.getQueryStringFormTargetSearch(deBase64QueryData,"Country_Code")||currentCountry,languageCode:methods.getQueryStringFormTargetSearch(deBase64QueryData,"Language_Code"),productId:methods.getQueryStringFormTargetSearch(deBase64QueryData,"ProductId"),country:methods.getQueryStringFormTargetSearch(url,"country"),language:methods.getQueryStringFormTargetSearch(url,"language")};var _window_customData_inlineLenaEnv;kdBotSDK.init({isShowIcon:true,env:(_window_customData_inlineLenaEnv=window1.customData.inlineLenaEnv)!==null&&_window_customData_inlineLenaEnv!==void 0?_window_customData_inlineLenaEnv:"PROD",siteParams:siteParams});$1("#kd-bot-app .kd-chat-icon").on("click",function(){methods.inlineLenaTrack("click","floatIcon")});$1(".smartAvatar_operation .operation_other").removeClass("hide");window1.haveSmartAvatarTab=window1.haveSmartAvatarTab||[];if($1(".smartAvatar_suspended").is(":visible")||$1(".smartAvatar_operation").is(":visible")||window1.haveSmartAvatarTab.includes("ProductPromotion")||$1(".smartAvatar_operation").hasClass("cookieConsentToolimit")){$1("#kd-bot-app .kd-chat-icon").addClass("hide");methods.inlineLenaTrack("hideInlineLena","")}else{methods.inlineLenaTrack("display","")}}).fail(function(){methods.inlineLenaTrack("failLoadInlineLenaSDK","")});return}$1(".smartAvatar_operation .operation_other").removeClass("hide");$lenaBotWindow.html(methods.mustacheCompile(lenaBotHtml.join(""),config));methods.initLenaBotEvents($lenaBotWindow,config);generateDeferred.resolve(config);$lenaBotWindow.find('link[rel="stylesheet"]').on("load",function(){try{refreshTranslations($lenaBotWindow.find("[t]"));refreshPTranslations($lenaBotWindow.find("[tp]"))}catch(e){}if(stayTimeToShow>0){setTimeout(methods.showWindow,stayTimeToShow);return}methods.showWindow()}).on("error",function(){methods.hideWindow()})},initNewLenaChat:function initNewLenaChat(){var source=window1.location.href;var currentLanguage=l.CultureUtility.getCurrentLanguage().toLowerCase();var currentCountry=l.CultureUtility.getCurrentCountry().toLowerCase();var cl=currentCountry+"/"+currentLanguage;var sepcialLena=["dk/da","no/nb","se/sv","fi/fi","nl/nl"];if(sepcialLena.indexOf(cl)>-1){currentLanguage="en"}var newLenaChatParams=["CountryService="+currentCountry,"Language="+currentLanguage,"ReferenceUrl="+source,"SerialNumber="+(methods.mb(["config","product","ID"])(window1)||"")].join("&");var request=methods.caches[newLenaChatParams]?$1.Deferred().resolve(methods.caches[newLenaChatParams]):$1.get(l.UrlUtility.getFullServicesPath("/v4/assisted/lena-bot"+"?"+newLenaChatParams));return request.then(function(res){if(methods.mb(["status"])(res)==="success"){methods.caches[newLenaChatParams]=res}return methods.initNewLenaChatCallback(res,{source:source})}).catch(function(e){methods.hideInlineLena();methods.hideWindow()})},mustacheCompile:function mustacheCompile(str,data){var reg=/\{\{(.*?)\}\}/;if(!reg.exec(str))return str;var tmp=str;while(reg.exec(str)){var placeholder=reg.exec(tmp)[0];var key=reg.exec(tmp)[1];tmp=tmp.replace(placeholder,"");str=str.replace(placeholder,data[key]?data[key].toString():"")}return str},getQueryStringFormTargetSearch:function getQueryStringFormTargetSearch(targetSearchString,name){if(!(targetSearchString&&typeof targetSearchString==="string")){return null}var reg=new RegExp("(?:[?|&]?)"+name+"=([^&]*)(?:&|$)","i");var r=targetSearchString.match(reg);if(r!=null)return decodeURIComponent(r[1]);return null}};methods.init();$lenaBotWindow.hide();window1.openLenaWindow=methods.openLenaWindow})($,window);