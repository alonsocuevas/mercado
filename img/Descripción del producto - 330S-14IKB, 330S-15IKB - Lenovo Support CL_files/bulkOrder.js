var bulkOption={};(function(bulkOption){function svsOption(serviceOption){if(!String.prototype.includes){Object.defineProperty(String.prototype,"includes",{configurable:true,writable:true,enumerable:false,value:function includes(search,start){"use strict";if(typeof start!=="number"){start=0}if(start+search.length>this.length){return false}else{return this.indexOf(search,start)!==-1}}})}if(!Array.prototype.includes){Object.defineProperty(Array.prototype,"includes",{configurable:true,writable:true,enumerable:false,value:function includes(valueToFind,fromIndex){if(this==null){throw new TypeError('"this" is null or not defined')}var o=Object(this);var len=o.length>>>0;if(len===0){return false}var n=fromIndex|0;var k=Math.max(n>=0?n:len-Math.abs(n),0);function sameValueZero(x,y){return x===y||typeof x==="number"&&typeof y==="number"&&isNaN(x)&&isNaN(y)}while(k<len){if(sameValueZero(o[k],valueToFind)){return true}k++}return false}})}if(!Array.from){Object.defineProperty(Array,"from",{configurable:true,writable:true,enumerable:false,value:function(){var toStr=Object.prototype.toString;var isCallable=function isCallable(fn){return typeof fn==="function"||toStr.call(fn)==="[object Function]"};var toInteger=function toInteger(value){var number=Number(value);if(isNaN(number)){return 0}if(number===0||!isFinite(number)){return number}return(number>0?1:-1)*Math.floor(Math.abs(number))};var maxSafeInteger=Math.pow(2,53)-1;var toLength=function toLength(value){var len=toInteger(value);return Math.min(Math.max(len,0),maxSafeInteger)};return function from(arrayLike){var C=this;var items=Object(arrayLike);if(arrayLike==null){throw new TypeError("Array.from requires an array-like object - not null or undefined")}var mapFn=arguments.length>1?arguments[1]:void undefined;var T;if(typeof mapFn!=="undefined"){if(!isCallable(mapFn)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){T=arguments[2]}}var len=toLength(items.length);var A=isCallable(C)?Object(new C(len)):new Array(len);var k=0;var kValue;while(k<len){kValue=items[k];if(mapFn){A[k]=typeof T==="undefined"?mapFn(kValue,k):mapFn.call(T,kValue,k)}else{A[k]=kValue}k+=1}A.length=len;return A}}()})}serviceOption.filterAddon=function(orgResponseData,pn){var result={needDisplayed:[],canBeSelected:[],locked:[],selected:[],selectedWarranty:null};if(this.addonOrderInit===undefined&&orgResponseData.addons!=undefined&&orgResponseData.addons&&orgResponseData.addons.length>1){orgResponseData.addons.map(function(m){if(m.warrantyCode=="ISE"){m.sortCode="ZZZ"}else{m.sortCode=m.warrantyCode}});orgResponseData.addons.sort(function(a,b){if(a.sortCode<b.sortCode){return-1}if(a.sortCode>b.sortCode){return 1}return 0});this.addonOrderInit=true}var responseData=JSON.parse(JSON.stringify(orgResponseData));if(responseData&&responseData.addons){if(!pn||pn=="BASE"){result=_getAddonForCurrentWarranty(responseData);delete window["lastSelectedAddons"];delete window["lastSelectedWarrantyPn"]}else{var isWarranty=responseData.warranties.filter(function(warranty){return warranty.partNumber==pn}).length>0;if(isWarranty){if(window["lastSelectedWarrantyPn"]==pn){delete window["lastSelectedWarrantyPn"];result=_getAddonForCurrentWarranty(responseData)}else{window["lastSelectedWarrantyPn"]=pn;result=_getAddonForSpecificWarranty(responseData,pn)}if(result.locked&&result.locked.length>0)window["lastSelectedAddons"]=result.locked.map(function(locaked){return locaked.partNumber});else delete window["lastSelectedAddons"]}else{result=window["lastSelectedWarrantyPn"]?_getAddonForSpecificWarranty(responseData,window["lastSelectedWarrantyPn"]):_getAddonForCurrentWarranty(responseData);if(window["lastSelectedAddons"]&&window["lastSelectedAddons"].includes(pn))window["lastSelectedAddons"]=window["lastSelectedAddons"].filter(function(selectedAddon){return selectedAddon!=pn});else{if(window["lastSelectedAddons"]==null)window["lastSelectedAddons"]=[];window["lastSelectedAddons"].push(pn)}result.locked=result.locked.filter(function(x){if(x.warrantyCode==="ISE"){var hasISE=false;window["lastSelectedAddons"].filter(function(addonpn){var addon=null;responseData.addons.filter(function(temp){if(temp.partNumber===addonpn){addon=temp}return true});if(addon.warrantyCode=="ISE")hasISE=true;return true});return hasISE}return window["lastSelectedAddons"].indexOf(x.partnumber)>=0})}}}if(window["lastSelectedAddons"]&&window["lastSelectedAddons"].length>0){var selectedDependencies=responseData.addons.filter(function(addon){if(addon.dependencies){var include=false;window["lastSelectedAddons"].concat(result.locked.map(function(lockedAddon){return lockedAddon.partNumber})).some(function(selectedAddon){if(addon.dependencies.includes(selectedAddon))include=true;return include==true});return include}return false});result.needDisplayed=result.needDisplayed.concat(selectedDependencies);result.canBeSelected=result.canBeSelected.concat(selectedDependencies);if(result.locked&&result.locked.length>0){selectedDependencies.map(function(selectedAddon){var addons=result.locked.filter(function(lockedAddon){return lockedAddon.warrantyCode==selectedAddon.warrantyCode});if(addons&&addons.length>0){if(selectedAddon.unitTerm>addons[0].unitTerm){addons[0].unitTerm=selectedAddon.unitTerm;addons[0].partNumber=selectedAddon.partNumber}}})}}result.locked=_distinct(_filterArray(result.locked,responseData));result.needDisplayed=_distinct(_filterArray(result.needDisplayed,responseData));result.canBeSelected=_distinct(_filterArray(result.canBeSelected,responseData));result.needDisplayed=_distinct(result.needDisplayed.concat(result.canBeSelected));result.selectedWarranty=window["lastSelectedWarrantyPn"]?window["lastSelectedWarrantyPn"]:"BASE";result.selected=window["lastSelectedAddons"]&&window["lastSelectedAddons"].length>0?window["lastSelectedAddons"]:[];result.selected=result.selected.filter(function(item){return result.needDisplayed.includes(item)});if(result.locked&&result.locked.length>0){result.selected=_distinct(result.selected.concat(result.locked))}result.selected=_clearInvalidSelected(responseData.addons,result.selected,result.selectedWarranty);if(responseData.optionsSetting&&responseData.optionsSetting.mandatoryBundle&&responseData.optionsSetting.iseNeedBundle&&result.selected&&result.selected.length>0){var iseDependencyAddons=responseData.addons.filter(function(addon){return result.selected.includes(addon.partNumber)&&responseData.optionsSetting.iseBundlesWithTypes.includes(addon.warrantyCode)});if(iseDependencyAddons!=null&&iseDependencyAddons.length>0){var unitTerm=iseDependencyAddons[0].unitTerm;var ise=responseData.addons.filter(function(addon){return addon.warrantyCode=="ISE"&&addon.unitTerm==unitTerm});if(ise&&ise.length>0&&result.needDisplayed.includes(ise[0].partNumber)){result.locked.push(ise[0].partNumber);result.selected.push(ise[0].partNumber)}}}if(responseData.optionsSetting&&responseData.optionsSetting.iseBundlesWithTypes&&responseData.optionsSetting.iseBundlesWithTypes.length>0){var maxTerm=Math.max.apply(Math,responseData.addons.filter(function(addon){return result.selected.includes(addon.partNumber)&&responseData.optionsSetting.iseBundlesWithTypes.includes(addon.warrantyCode)}).map(function(selectedAddon){return selectedAddon.unitTerm}));var maxTermIses=responseData.addons.filter(function(addon){return addon.warrantyCode=="ISE"&&addon.unitTerm==maxTerm});if(maxTermIses&&maxTermIses.length>0){maxTermIse=maxTermIses[0];var beforeLength=result.needDisplayed.length;result.needDisplayed=responseData.addons.filter(function(addon){return result.needDisplayed.includes(addon.partNumber)}).filter(function(displayedAddon){return displayedAddon.warrantyCode!="ISE"}).map(function(m){return m.partNumber});if(beforeLength!=result.needDisplayed.length)result.needDisplayed.push(maxTermIse.partNumber);beforeLength=result.canBeSelected.length;result.canBeSelected=responseData.addons.filter(function(addon){return result.canBeSelected.includes(addon.partNumber)}).filter(function(canBeSelectedAddon){return canBeSelectedAddon.warrantyCode!="ISE"}).map(function(m){return m.partNumber});if(beforeLength!=result.canBeSelected.length)result.canBeSelected.push(maxTermIse.partNumber);beforeLength=result.locked.length;result.locked=responseData.addons.filter(function(addon){return result.locked.includes(addon.partNumber)}).filter(function(lockedAddon){return lockedAddon.warrantyCode!="ISE"}).map(function(m){return m.partNumber});if(beforeLength!=result.locked.length)result.locked.push(maxTermIse.partNumber);beforeLength=result.selected.length;result.selected=responseData.addons.filter(function(addon){return result.selected.includes(addon.partNumber)}).filter(function(selectedAddon){return selectedAddon.warrantyCode!="ISE"}).map(function(m){return m.partNumber});if(beforeLength!=result.selected.length)result.selected.push(maxTermIse.partNumber)}}result.selected=_distinct(result.selected.concat(result.locked));window["lastSelectedAddons"]=result.selected;result.locked=[];return result};_getAddonForCurrentWarranty=function _getAddonForCurrentWarranty1(responseData){var result={needDisplayed:[],canBeSelected:[],locked:[]};if(responseData.addons&&responseData.addons.length>0){var dependenciesAddon=responseData.addons.filter(function(item){return item.dependencies&&item.dependencies.includes("BASE")});result.needDisplayed=_recursiveGetDependencies(responseData.addons,dependenciesAddon);result.canBeSelected=dependenciesAddon}return result};_getAddonForSpecificWarranty=function _getAddonForSpecificWarranty1(responseData,pn){var result={needDisplayed:[],canBeSelected:[],locked:[]};if(pn){var selectedWarranties=responseData.warranties.filter(function(item){return item.partNumber==pn});if(selectedWarranties&&selectedWarranties.length>0){var selectedWarranty=selectedWarranties[0];result.canBeSelected=responseData.addons.filter(function(item){return item.dependencies&&item.dependencies.includes(pn)});result.needDisplayed=_recursiveGetDependencies(responseData.addons,result.canBeSelected);if(responseData.optionsSetting&&responseData.optionsSetting.mandatoryBundle&&selectedWarranty.bundles&&selectedWarranty.bundles.length>0){result.locked=responseData.addons.filter(function(item){return selectedWarranty.bundles.includes(item.partNumber)})}}}return result};_filterArray=function _filterArray1(addons,responseData){var tempList=[];addons.map(function(m){var addon=tempList.filter(function(f){return f.warrantyCode==m.warrantyCode});if(responseData.optionsSetting&&responseData.optionsSetting.durationNeedAline&&addon&&addon.length>0){if(m.unitTerm>addon[0].unitTerm){addon[0].unitTerm=m.unitTerm;addon[0].partNumber=m.partNumber}}else{tempList.push(m)}});return tempList.map(function(temp){return temp.partNumber})};_recursiveGetDependencies=function _recursiveGetDependencies1(addons,dependenciesAddon){var result=[];if(addons&&addons.length>0&&dependenciesAddon&&dependenciesAddon.length>0){result=result.concat(dependenciesAddon);if(result.length>0){var _loop=function(){var addNumber=0;result.map(function(r){var dependencies=addons.filter(function(addon){return addon.dependencies&&addon.dependencies.includes(r.partNumber)});if(dependencies.length>0){dependencies.forEach(function(f){var exists=result.filter(function(item){return item.partNumber==f.partNumber}).length>0;if(!exists){result.push(f);addNumber++}})}});if(addNumber==0)needBreak=true};var needBreak=false;while(!needBreak)_loop()}}return result};_clearInvalidSelected=function _clearInvalidSelected1(addons,selected,selectedWarranty){var needBreak=false;if(addons&&addons.length>0){var _loop=function(){var needRemoveIds=[];selected.map(function(s){var selectedAddons=addons.filter(function(a){return a.partNumber==s});if(selectedAddons&&selectedAddons.length>0){var dependencies=selectedAddons[0].dependencies;if(dependencies&&dependencies.length>0){var exists=dependencies.includes(selectedWarranty);if(!exists){dependencies.some(function(dependencyPartNumber){exists=selected.filter(function(partNumber){return partNumber==dependencyPartNumber}).length>0;return exists==true})}if(!exists)needRemoveIds.push(s)}}else needRemoveIds.push(s)});if(needRemoveIds.length>0)selected=selected.filter(function(f){return!needRemoveIds.includes(f)});else needBreak=true};while(!needBreak)_loop()}return selected};_distinct=function _distinct1(arr){arr=arr||[];var newArr=[];arr.forEach(function(item){if(newArr.indexOf(item)===-1)newArr.push(item)});return newArr}}var res=[];var valid={good:[0,0,0,0,0],better:[0,0,0,0,0],best:[0,0,0,0,0],adp:[0,0,0,0,0],kyd:[0,0,0,0,0],sb:[0,0,0,0,0],ticru:[0,0,0,0,0],ise:[0,0,0,0,0],fixedEnd:false};var level={PREMIER:"best",PREMIUMCARE:"best",LEGIONULTIMATE:"best",ONSITE:"better",DEPOT:"good",MAILIN:"good",CARRYIN:"good",ADP:"adp",SB:"sb",KYD:"kyd",TICRU:"ticru",ISE:"ise"};var data=null;var snContexts={};var valid2=null;bulkOption.init=function(initData){res=initData;valid={good:[0,0,0,0,0],better:[0,0,0,0,0],best:[0,0,0,0,0],adp:[0,0,0,0,0],kyd:[0,0,0,0,0],sb:[0,0,0,0,0],ticru:[0,0,0,0,0],ise:[0,0,0,0,0],fixedEnd:false};level={PREMIER:"best",PREMIUMCARE:"best",LEGIONULTIMATE:"best",ONSITE:"better",DEPOT:"good",MAILIN:"good",CARRYIN:"good",ADP:"adp",SB:"sb",KYD:"kyd",TICRU:"ticru",ISE:"ise"};data=null;snContexts={};res.forEach(function(r){data=r.data;if(!data.valid){data.valid={good:[0,0,0,0,0],better:[0,0,0,0,0],best:[0,0,0,0,0],adp:[0,0,0,0,0],kyd:[0,0,0,0,0],sb:[0,0,0,0,0],ticru:[0,0,0,0,0],ise:[0,0,0,0,0]}}if(!data.map){data.map={}}if(!data.map2){data.map2={}}if(data&&data.warranties){data.warranties.forEach(function(warranty){warranty.bundles=null;if(warranty&&warranty.warrantyCode==="ADPONE")return;try{data.valid[level[warranty.warrantyCode]][warranty.unitTerm/12-1]=1;data.map[level[warranty.warrantyCode]+[warranty.unitTerm/12]]=warranty.partNumber;data.map2[warranty.partNumber]=level[warranty.warrantyCode]+[warranty.unitTerm/12]}catch(e){console.log(warranty.warrantyCode)}})}if(data&&data.addons){data.addons.forEach(function(addon){if(addon&&addon.warrantyCode==="ADPONE")return;try{data.valid[level[addon.warrantyCode]][addon.unitTerm/12-1]=1;data.map[level[addon.warrantyCode]+[addon.unitTerm/12]]=addon.partNumber;data.map2[addon.partNumber]=level[addon.warrantyCode]+[addon.unitTerm/12]}catch(e){console.log(addon.warrantyCode)}})}if(data.ibase.machineInfo){snContexts[data.ibase.machineInfo.serial]={data:data,result:null}}});res.forEach(function(r){snValid=r.data.valid;Object.keys(valid).forEach(function(i){if(!["good","better","best"].includes(i))return;for(var k=0;k<5;k++){valid[i][k]+=snValid[i][k]}})});valid2=JSON.parse(JSON.stringify(valid))};bulkOption.run=function(select){select=JSON.parse(JSON.stringify(select));if(select.length>0){if(select[select.length-1].startsWith("ise")){select.splice(select.length-1,1)}}valid=JSON.parse(JSON.stringify(valid2));var fixedEnd=false;Object.keys(snContexts).forEach(function(k){v=snContexts[k];data=v.data;if(data.warranties.length==0&&data.addons.length==0){return}data.optionsSetting.mandatoryBundle=false;fixedEnd=data.optionsSetting.durationNeedAline;window["lastSelectedAddons"]=null;window["lastSelectedWarrantyPn"]=null;data.ready=false;var so={};var x=svsOption(so);var result=null;var c=0;if(select.length==0){result=so.filterAddon(data,"BASE");c=0}else{select.some(function(i){try{if(!data.map[i])return true;if(result&&result.canBeSelected&&!result.canBeSelected.includes(data.map[i])){return true}result=so.filterAddon(data,data.map[i]);c++}catch(e){return true}})}if(result&&result.canBeSelected)result.canBeSelected.forEach(function(i){i=data.map2[i];valid[i.substr(0,i.length-1)][parseInt(i[i.length-1])-1]++});if(c==select.length&&select.length!=0){data.ready=true}});valid.fixedEnd=fixedEnd;return valid};function getPN(data,pn){var result=null;data.warranties.some(function(warranty){if(warranty.partNumber==pn){var tempPn={};tempPn.partNumber=pn;tempPn.formatOriginalPrice=warranty.formatIncludingTaxUnitPrice;tempPn.originalPrice=warranty.includingTaxUnitPrice;tempPn.formatPaidPrice=warranty.formattedIncludingTaxAndDiscountValue;tempPn.paidPrice=warranty.includingTaxAndDiscountValue;var name=data.map2[warranty.partNumber];tempPn.description=name[name.length-1]+" yr "+warranty.warrantyName;tempPn.type=warranty.warrantyCode.toLowerCase().trim();result=tempPn;return true}if(result!=null)return result});data.addons.some(function(addon){if(addon.partNumber==pn){var tempPn={};tempPn.partNumber=pn;tempPn.formatOriginalPrice=addon.formatIncludingTaxUnitPrice;tempPn.originalPrice=addon.includingTaxUnitPrice;tempPn.formatPaidPrice=addon.formattedIncludingTaxAndDiscountValue;tempPn.paidPrice=addon.includingTaxAndDiscountValue;var name=data.map2[addon.partNumber];tempPn.description=name[name.length-1]+" yr "+addon.warrantyName;tempPn.type=addon.warrantyCode.toLowerCase().trim();result=tempPn}});return result}function hasType(pnList,type){var types=[];pnList.forEach(function(pn){if(["premier","premiumcare","legionultimatesupport"].includes(pn.type))types.push("best");else if(["onsite"].includes(pn.type))types.push("better");else if(["depot","mailin","mail-in","carryin","carry-in"].includes(pn.type))types.push("good");else types.push(pn.type)});return types.includes(type)}bulkOption.getResult=function(select){originalSelect=select;select=JSON.parse(JSON.stringify(originalSelect));var response=[];var hasISE=false;if(select.length==0)return response;if(select[select.length-1].substring(0,3)=="ise"){select.splice(select.length-1,1);hasISE=true}Object.keys(snContexts).forEach(function(k){v=snContexts[k];data=v.data;if(data.warranties.length==0&&data.addons.length==0){var temp={};temp.serialNumber=data.ibase.machineInfo.serial;temp.machineType=data.ibase.machineInfo.type;temp.productName=data.ibase.machineInfo.productName;temp.status="Not Matched";temp.pnList=[];response.push(temp);return}if(data.ready&&data.ready==true){var temp={};temp.serialNumber=data.ibase.machineInfo.serial;temp.machineType=data.ibase.machineInfo.type;temp.productName=data.ibase.machineInfo.productName;temp.status="Matched";temp.pnList=[];select.some(function(i){var pn=data.map[i];var t=getPN(data,pn);if(t!=null){temp.pnList.push(t)}});response.push(temp);return}data.optionsSetting.mandatoryBundle=false;window["lastSelectedAddons"]=null;window["lastSelectedWarrantyPn"]=null;data.ready=false;var so={};var x=svsOption(so);var result=so.filterAddon(data,"BASE");var c=0;var candidates=[];var typeof0=select[0].substring(0,select[0].length-1);var fixedEnd=data.optionsSetting.durationNeedAline;var fixedYr=-1;var base=false;if(!typeof0=="good"&&!typeof0=="better"&&!typeof0=="best"){base=true;fixedYr=data.ibase.currentEffectiveWarranty.duration/12;selectYr=fixedYr}else{selectYr=select[0].slice(-1)}var foundInWarranties=base;var selectedIse=false;var n=0;select.some(function(i){var type=i.substr(0,i.length-1);var yr=parseInt(i[i.length-1]);if(n===0&&!base){try{var currentType=data.ibase.currentEffectiveWarranty.level.toLowerCase();var currentDuration=data.ibase.currentEffectiveWarranty.duration/12;if(currentType===type&&currentDuration===yr){c++;foundInWarranties=true;fixedYr=yr;base=true;n++;return false}}catch(e){}}n++;if(type==="ise"){selectedIse=true;candidates.forEach(function(item){})}for(var _$k=yr;_$k>=1;_$k--){try{if(foundInWarranties&&fixedEnd&&_$k!=fixedYr){if(!(fixedYr>3&&type=="sb"&&_$k==3)){continue}}if(!foundInWarranties)data.warranties.some(function(warranty){if(warranty.partNumber==data.map[type+_$k]){foundInWarranties=true;fixedYr=_$k;return true}});if(data.map[type+_$k]==undefined||result&&result.canBeSelected&&!result.canBeSelected.includes(data.map[type+_$k])&&!foundInWarranties)continue;result=so.filterAddon(data,data.map[i]);c++;candidates.push(data.map[type+_$k]);break}catch(e){return true}}});if(c==select.length){var temp={};temp.serialNumber=data.ibase.machineInfo.serial;temp.machineType=data.ibase.machineInfo.type;temp.productName=data.ibase.machineInfo.productName;temp.status="Partially Matched";temp.pnList=[];temp.fixedYr=fixedYr;temp.selectYr=selectYr;temp.base=base;temp.remark=[];candidates.forEach(function(i){var t=getPN(data,i);if(t!=null){temp.pnList.push(t)}});var yr=parseInt(select[0][select[0].length-1]);if(base)temp.remark.push("Current warranty is just "+yr+" Yr "+data.ibase.currentEffectiveWarranty.deliveryTypeName);response.push(temp)}else{var temp={};temp.serialNumber=data.ibase.machineInfo.serial;temp.machineType=data.ibase.machineInfo.type;temp.productName=data.ibase.machineInfo.productName;temp.status="Not Matched";temp.pnList=[];temp.fixedYr=fixedYr;temp.selectYr=selectYr;temp.base=base;candidates.forEach(function(i){var t=getPN(data,i);if(t!=null){temp.pnList.push(t)}});response.push(temp)}});if(hasISE){response.forEach(function(i){var v1=snContexts[i.serialNumber];data=v1.data;ISEs=data.addons.filter(function(addon){return addon.warrantyCode==="ISE"});ISEs.sort(function(a,b){return a.unitTerm<b.unitTerm?1:-1});var iseFound=false;ISEs.some(function(ise){i.pnList.some(function(pn){if(ise.dependencies.includes("BASE")||ise.dependencies.includes(pn.partNumber)){iseFound=true;var t=getPN(data,ise.partNumber);if(t!=null){i.pnList.push(t)}return true}});if(iseFound)return true});if(!i.remark){i.remark=[]}if(ISEs.length>0){if(!iseFound){i.status="Not Matched";i.remark.push("ISE has to be purchased together with ADP/KYD/SB.")}}else{if(i.status=="Matched"){i.status=="Partially Matched"}if(i.status!="Not Matched")i.remark.push("The product doesn't support ISE.")}})}response.forEach(function(item){if(!item.remark)item.remark=[];if(item.pnList.length==0){item.status="Not Matched"}else if(originalSelect.length!=item.pnList.length&&item.status==="Matched"){item.status="Partially Matched"}var data=snContexts[item.serialNumber].data;if(item.status==="Partially Matched"){if(item.fixedYr!=item.selectYr)item.remark.push("The longest warranty upgrades for the product are "+item.fixedYr+" years.")}if(item.status==="Not Matched"){if(data&&data.ibase&&data.ibase.currentEffectiveWarranty&&data.warranties&&data.addons){if(data.warranties.length===0&&data.addons.length===0){var date1=new Date(data.ibase.currentEffectiveWarranty.endDate);var date2=Date.now();var diffTime=Math.abs(date2-date1);if(diffTime>0){item.remark.push("Warranty expired.")}else{item.remark.push("You have an entitlement that cannot be extended or upgraded at this time.")}return}}else{item.remark.push("You have an entitlement that cannot be extended or upgraded at this time.");return}originalSelect.forEach(function(sel){var type=sel.substr(0,sel.length-1);var yr=parseInt(sel[sel.length-1]);if(!hasType(item.pnList,type)){if(type==="adp"){var date1=new Date(data.ibase.currentEffectiveWarranty.startDate);var date2=Date.now();var diffTime=Math.abs(date2-date1);var diffDays=Math.ceil(diffTime/(1e3*60*60*24));if(diffDays>90)item.remark.push("ADP cannot be purchased beyond 90 days.");else item.remark.push("No ADP offerings for this product.")}if(["sb","kyd","ticru"].includes(type)){var addons=data.addons.filter(function(addon){return addon.warrantyCode.toLowerCase()===type});if(addons.length>0){addons.sort(function(a,b){return a.unitTerm<b.unitTerm?1:-1});var yr=addons[0].unitTerm/12;item.remark.push("The longest "+type.toUpperCase()+" offering in this case is "+yr+" years.")}else item.remark.push("No "+type.toUpperCase()+" offerings for this product.")}if(["good","better","best"].includes(type)){}}});return}});return response};bulkOption.getResultExtendOnly=function(select){originalSelect=select;select=JSON.parse(JSON.stringify(originalSelect));var response=[];var hasISE=false;if(select.length==0)return response;if(select[select.length-1].substring(0,3)=="ise"){select.splice(select.length-1,1);hasISE=true}Object.keys(snContexts).forEach(function(k){select=JSON.parse(JSON.stringify(originalSelect));v=snContexts[k];data=v.data;var dur=select[0];select[0]=level[data.ibase.currentEffectiveWarranty.deliveryType]+select[0];if(data.warranties.length==0&&data.addons.length==0){var temp={};temp.serialNumber=data.ibase.machineInfo.serial;temp.machineType=data.ibase.machineInfo.type;temp.productName=data.ibase.machineInfo.productName;temp.status="Not Matched";temp.pnList=[];response.push(temp);return}if(data.ready&&data.ready==true){var temp={};temp.serialNumber=data.ibase.machineInfo.serial;temp.machineType=data.ibase.machineInfo.type;temp.productName=data.ibase.machineInfo.productName;temp.status="Matched";temp.pnList=[];select.some(function(i){var pn=data.map[i];var t=getPN(data,pn);if(t!=null){temp.pnList.push(t)}});response.push(temp);return}data.optionsSetting.mandatoryBundle=false;window["lastSelectedAddons"]=null;window["lastSelectedWarrantyPn"]=null;data.ready=false;var so={};var x=svsOption(so);var result=so.filterAddon(data,"BASE");var c=0;var candidates=[];var typeof0=select[0].substring(0,select[0].length-1);var fixedEnd=data.optionsSetting.durationNeedAline;var fixedYr=-1;var base=false;if(!typeof0=="good"&&!typeof0=="better"&&!typeof0=="best"){base=true;fixedYr=data.ibase.currentEffectiveWarranty.duration/12;selectYr=fixedYr}else{selectYr=select[0].slice(-1)}var foundInWarranties=base;var selectedIse=false;var n=0;select.some(function(i){var type=i.substr(0,i.length-1);var yr=parseInt(i[i.length-1]);if(n===0&&!base){try{var currentType=data.ibase.currentEffectiveWarranty.level.toLowerCase();var currentDuration=data.ibase.currentEffectiveWarranty.duration/12;if(currentType===type&&currentDuration===yr){c++;foundInWarranties=true;fixedYr=yr;base=true;n++;return false}}catch(e){}}n++;if(type==="ise"){selectedIse=true;candidates.forEach(function(item){})}for(var _$k=yr;_$k>=1;_$k--){try{if(foundInWarranties&&fixedEnd&&_$k!=fixedYr){if(!(fixedYr>3&&type=="sb"&&_$k==3)){continue}}if(!foundInWarranties)data.warranties.some(function(warranty){if(warranty.partNumber==data.map[type+_$k]){foundInWarranties=true;fixedYr=_$k;return true}});if(data.map[type+_$k]==undefined||result&&result.canBeSelected&&!result.canBeSelected.includes(data.map[type+_$k])&&!foundInWarranties)continue;result=so.filterAddon(data,data.map[i]);c++;candidates.push(data.map[type+_$k]);break}catch(e){return true}}});if(c==select.length){var temp={};temp.serialNumber=data.ibase.machineInfo.serial;temp.machineType=data.ibase.machineInfo.type;temp.productName=data.ibase.machineInfo.productName;temp.status="Partially Matched";temp.pnList=[];temp.fixedYr=fixedYr;temp.selectYr=selectYr;temp.base=base;temp.remark=[];candidates.forEach(function(i){var t=getPN(data,i);if(t!=null){temp.pnList.push(t)}});var yr=parseInt(select[0][select[0].length-1]);if(base)temp.remark.push("Current warranty is just "+yr+" Yr "+data.ibase.currentEffectiveWarranty.deliveryTypeName);response.push(temp)}else{var temp={};temp.serialNumber=data.ibase.machineInfo.serial;temp.machineType=data.ibase.machineInfo.type;temp.productName=data.ibase.machineInfo.productName;temp.status="Not Matched";temp.pnList=[];temp.fixedYr=fixedYr;temp.selectYr=selectYr;temp.base=base;candidates.forEach(function(i){var t=getPN(data,i);if(t!=null){temp.pnList.push(t)}});response.push(temp)}});if(hasISE){response.forEach(function(i){var v1=snContexts[i.serialNumber];data=v1.data;ISEs=data.addons.filter(function(addon){return addon.warrantyCode==="ISE"});ISEs.sort(function(a,b){return a.unitTerm<b.unitTerm?1:-1});var iseFound=false;ISEs.some(function(ise){i.pnList.some(function(pn){if(ise.dependencies.includes("BASE")||ise.dependencies.includes(pn.partNumber)){iseFound=true;var t=getPN(data,ise.partNumber);if(t!=null){i.pnList.push(t)}return true}});if(iseFound)return true});if(!i.remark){i.remark=[]}if(ISEs.length>0){if(!iseFound){i.status="Not Matched";i.remark.push("ISE has to be purchased together with ADP/KYD/SB.")}}else{if(i.status=="Matched"){i.status=="Partially Matched"}if(i.status!="Not Matched")i.remark.push("The product doesn't support ISE.")}})}response.forEach(function(item){if(!item.remark)item.remark=[];if(item.pnList.length==0){item.status="Not Matched"}else if(originalSelect.length!=item.pnList.length&&item.status==="Matched"){item.status="Partially Matched"}var data=snContexts[item.serialNumber].data;if(item.status==="Partially Matched"){if(item.fixedYr!=item.selectYr)item.remark.push("The longest warranty upgrades for the product are "+item.fixedYr+" years.")}if(item.status==="Not Matched"){if(data&&data.ibase&&data.ibase.currentEffectiveWarranty&&data.warranties&&data.addons){if(data.warranties.length===0&&data.addons.length===0){var date1=new Date(data.ibase.currentEffectiveWarranty.endDate);var date2=Date.now();var diffTime=Math.abs(date2-date1);if(diffTime>0){item.remark.push("Warranty expired.")}else{item.remark.push("You have an entitlement that cannot be extended or upgraded at this time.")}return}}else{item.remark.push("You have an entitlement that cannot be extended or upgraded at this time.");return}originalSelect.forEach(function(sel){var type=sel.substr(0,sel.length-1);var yr=parseInt(sel[sel.length-1]);if(!hasType(item.pnList,type)){if(type==="adp"){var date1=new Date(data.ibase.currentEffectiveWarranty.startDate);var date2=Date.now();var diffTime=Math.abs(date2-date1);var diffDays=Math.ceil(diffTime/(1e3*60*60*24));if(diffDays>90)item.remark.push("ADP cannot be purchased beyond 90 days.");else item.remark.push("No ADP offerings for this product.")}if(["sb","kyd","ticru"].includes(type)){var addons=data.addons.filter(function(addon){return addon.warrantyCode.toLowerCase()===type});if(addons.length>0){addons.sort(function(a,b){return a.unitTerm<b.unitTerm?1:-1});var yr=addons[0].unitTerm/12;item.remark.push("The longest "+type.toUpperCase()+" offering in this case is "+yr+" years.")}else item.remark.push("No "+type.toUpperCase()+" offerings for this product.")}if(["good","better","best"].includes(type)){}}});return}});return response}})(bulkOption);