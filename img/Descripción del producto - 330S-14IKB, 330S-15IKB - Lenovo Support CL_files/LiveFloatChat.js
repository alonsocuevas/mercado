(function($,w){var floatChatWindow=$("#float-chat-window");var html=['<link href="/esv4/plugins/contactus/livefloatchat/livefloatchat.css" rel="stylesheet" />','<div class="chatWindow" style="display: none">','<a class="chatClose"></a>','<div class="chatContent">','<img class="chatImg" src="/msa/contact/plugins/Contactus/contactChat.png">','<h4 t="chat with a lenovo specialist|Chat with a Lenovo Specialist"></h4>','<div class="btns">','<a class="button blue ok" t="yes" href="{{WarrantyLookupUrl}}"></a>','<button class="button blue right no" t="no"></button>','<div class="reset"></div>',"</div>",'<input type="checkbox" class="closeChoose"><label t="do not ask again"></label>',"</div>","</div>"];var isAvailableUrl=l.UrlUtility.getFullServicesPath("/contactus/isAvailable?_t="+new Date().getTime());var methods={IsAvailable:false,matchList:[],track:function track(type){type=type||"chat_invitation_offered";var _satellite=methods.mb(["_satellite"])(window);var track=methods.mb(["track"])(_satellite);if(track){_satellite.track(type)}},mb:function mb(p){return function(o){return p.map(function(c){return o=(o||{})[c]})&&o}},isShowFloatChat:function isShowFloatChat(){return!!Cookies.get("isShowFloatChat")},judgeMatchListValid:function judgeMatchListValid(url){url=url||window.location.pathname;return methods.matchList.some(function(x){return x.test(url)})},showAction:function showAction(e,url){if(methods.judgeMatchListValid(url)){methods.showWindow();return}methods.hideWindow()},init:function init(){$(window).on("pspSectionChanged",methods.showAction);floatChatWindow.on("click",".no,.chatClose",methods.chatClose);floatChatWindow.on("click",".closeChoose",methods.closeChoose);floatChatWindow.on("click","a.ok",methods.accepted);methods.initChat(window.location.href);w.LiveFloatChat=w.LiveFloatChat||methods.initChat},accepted:function accepted(){methods.track("chat_invitation_accepted");return true},showWindow:function showWindow(){if(methods.isShowFloatChat()&&methods.IsAvailable){return}$(".chatWindow",floatChatWindow).show();if($(".chatWindow").is(":visible")){methods.track("chat_invitation_offered")}},hideWindow:function hideWindow(){$(".chatWindow",floatChatWindow).hide()},judgeCallbackDataValid:function judgeCallbackDataValid(data){methods.IsAvailable=!!methods.mb(["IsAvailable"])(data);if(!methods.IsAvailable){return false}if(data.UrlTests&&data.UrlTests.length>0){for(var i=0;i<data.UrlTests.length;i++){methods.matchList.push(new RegExp(data.UrlTests[i]))}}return methods.judgeMatchListValid()},initCallback:function initCallback(data,presetJudgeResult){if(presetJudgeResult===false){return methods.hideWindow()}floatChatWindow.html(methods.mustacheCompile(html.join(""),data));if(!presetJudgeResult&&!methods.judgeCallbackDataValid(data)){return methods.hideWindow()}floatChatWindow.find('link[rel="stylesheet"]').on("load",function(){try{refreshTranslations(floatChatWindow.find("[t]"));refreshPTranslations(floatChatWindow.find("[tp]"))}catch(e){}var stayTime=data.StayTimeToShow;if(stayTime&&stayTime>0){setTimeout(methods.showAction,stayTime);return}methods.showAction()}).on("error",function(){methods.hideWindow()})},chatClose:function chatClose(){methods.track("chat_invitation_rejected");methods.hideWindow()},closeChoose:function closeChoose(){var value=$(this).prop("checked");if(value){Cookies.set("isShowFloatChat",false,{path:"/"})}},initChat:function initChat(){return $.get(isAvailableUrl).then(function(data){return methods.initCallback(data)}).catch(function(e){return methods.hideWindow()})},mustacheCompile:function mustacheCompile(str,data){var reg=/\{\{(.*?)\}\}/;if(!reg.exec(str))return str;var tmp=str;while(reg.exec(str)){var placeholder=reg.exec(tmp)[0];var key=reg.exec(tmp)[1];tmp=tmp.replace(placeholder,"");str=str.replace(placeholder,data[key]?data[key].toString():"")}return str}};methods.init()})(jQuery,window);